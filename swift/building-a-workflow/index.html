



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A library for making composable state machines, and UIs driven by those state machines.">
      
      
        <link rel="canonical" href="https://square.github.io/workflow/swift/building-a-workflow/">
      
      
        <meta name="author" content="Square, Inc.">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/icon-square.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Building a Workflow - Workflow</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#ef5350">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../css/app.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-144488214-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="red" data-md-color-accent="pink">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#building-a-workflow" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://square.github.io/workflow/" title="Workflow" class="md-header-nav__button md-logo">
          
            <img src="../../images/icon-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Workflow
            </span>
            <span class="md-header-nav__topic">
              
                Building a Workflow
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/square/workflow/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Workflow
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://square.github.io/workflow/" title="Workflow" class="md-nav__button md-logo">
      
        <img src="../../images/icon-square.png" width="48" height="48">
      
    </a>
    Workflow
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/square/workflow/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Workflow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../overview/" title="Documentation" class="md-nav__link">
      Documentation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../concepts/" title="Concepts" class="md-nav__link">
      Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      API Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        API Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Kotlin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Kotlin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../kotlin/api/workflow-core/com.squareup.workflow/" title="workflow-core" class="md-nav__link">
      workflow-core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kotlin/api/workflow-runtime/com.squareup.workflow/" title="workflow-runtime" class="md-nav__link">
      workflow-runtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kotlin/api/workflow-ui-core/com.squareup.workflow.ui/" title="workflow-ui-core" class="md-nav__link">
      workflow-ui-core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kotlin/api/workflow-ui-android/com.squareup.workflow.ui/" title="workflow-ui-android" class="md-nav__link">
      workflow-ui-android
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kotlin/api/workflow-testing/com.squareup.workflow.testing/" title="workflow-testing" class="md-nav__link">
      workflow-testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kotlin/api/workflow-rx2/com.squareup.workflow.rx2/" title="workflow-rx2" class="md-nav__link">
      workflow-rx2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Swift
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Swift
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../api/Workflow/README.md" title="Workflow" class="md-nav__link">
      Workflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/WorkflowUI/README.md" title="WorkflowUI" class="md-nav__link">
      WorkflowUI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/WorkflowTesting/README.md" title="WorkflowTesting" class="md-nav__link">
      WorkflowTesting
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Kotlin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Kotlin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../kotlin/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Swift
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Swift
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../adding-workflow-to-a-project/" title="Adding Workflow to a project" class="md-nav__link">
      Adding Workflow to a project
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tooling/" title="Tooling" class="md-nav__link">
      Tooling
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Building a Workflow
      </label>
    
    <a href="./" title="Building a Workflow" class="md-nav__link md-nav__link--active">
      Building a Workflow
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#render" title="Render" class="md-nav__link">
    Render
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state" title="state" class="md-nav__link">
    state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context" title="context" class="md-nav__link">
    context
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actions-or-things-that-advance-a-workflow" title="Actions, or “Things that advance a workflow”" class="md-nav__link">
    Actions, or “Things that advance a workflow”
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-update-cycle" title="The Update Cycle" class="md-nav__link">
    The Update Cycle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state_1" title="State" class="md-nav__link">
    State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workers-or-asynchronous-work-the-workflow-needs-done" title="Workers, or "Asynchronous work the workflow needs done"" class="md-nav__link">
    Workers, or "Asynchronous work the workflow needs done"
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-events" title="Output Events" class="md-nav__link">
    Output Events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#composition" title="Composition" class="md-nav__link">
    Composition
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-render-context" title="The Render Context" class="md-nav__link">
    The Render Context
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../building-a-view-controller-from-screen/" title="Building a View Controller from a Screen" class="md-nav__link">
      Building a View Controller from a Screen
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../using-a-workflow-for-ui/" title="Using a Workflow to Show UI" class="md-nav__link">
      Using a Workflow to Show UI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../CHANGELOG/" title="Change Log ⏏" class="md-nav__link">
      Change Log ⏏
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../CONTRIBUTING/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../CODE_OF_CONDUCT/" title="Code of Conduct" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#render" title="Render" class="md-nav__link">
    Render
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#state" title="state" class="md-nav__link">
    state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#context" title="context" class="md-nav__link">
    context
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actions-or-things-that-advance-a-workflow" title="Actions, or “Things that advance a workflow”" class="md-nav__link">
    Actions, or “Things that advance a workflow”
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-update-cycle" title="The Update Cycle" class="md-nav__link">
    The Update Cycle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state_1" title="State" class="md-nav__link">
    State
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#workers-or-asynchronous-work-the-workflow-needs-done" title="Workers, or "Asynchronous work the workflow needs done"" class="md-nav__link">
    Workers, or "Asynchronous work the workflow needs done"
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-events" title="Output Events" class="md-nav__link">
    Output Events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#composition" title="Composition" class="md-nav__link">
    Composition
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-render-context" title="The Render Context" class="md-nav__link">
    The Render Context
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/square/workflow/edit/master/docs/swift/building-a-workflow.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="building-a-workflow">Building a Workflow<a class="headerlink" href="#building-a-workflow" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>A simple workflow looks something like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">struct</span> <span class="nc">DemoWorkflow</span><span class="p">:</span> <span class="n">Workflow</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nv">name</span><span class="p">:</span> <span class="nb">String</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">name</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">extension</span> <span class="nc">DemoWorkflow</span> <span class="p">{</span>

    <span class="kd">struct</span> <span class="nc">State</span> <span class="p">{}</span>

    <span class="kd">func</span> <span class="nf">makeInitialState</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">State</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">State</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">workflowDidChange</span><span class="p">(</span><span class="n">from</span> <span class="n">previousWorkflow</span><span class="p">:</span> <span class="n">DemoWorkflow</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="kr">inout</span> <span class="n">State</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">RenderContext</span><span class="p">&lt;</span><span class="n">DemoWorkflow</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;Hello, </span><span class="si">\(</span><span class="n">name</span><span class="si">)</span><span class="s">&quot;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>A type conforming to <code>Workflow</code> represents a single node in the workflow tree. It should contain any
values that must be provided by its parent (who is generally responsible for creating child
workflows).</p>
<p>Configuration parameters, strings, network services… If your workflow needs access to a value or
object that it cannot create itself, they should be passed into the workflow&rsquo;s initializer.</p>
<p>Every workflow defines its own <code>State</code> type to contain any data that should persist through
subsequent render passes.</p>
<h2 id="render">Render<a class="headerlink" href="#render" title="Permanent link">&para;</a></h2>
<p>Workflows are only useful when they render a value for use by their parent (or, if they are the root
workflow, for display). This type is very commonly a view model, or <code>Screen</code>. The
<code>render(state:context:)</code> method has a couple of parameters, so we’ll work through them one by one.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">RenderContext</span><span class="p">&lt;</span><span class="n">DemoWorkflow</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="n">Rendering</span>
</pre></div>
</td></tr></table>

<h3 id="state"><code>state</code><a class="headerlink" href="#state" title="Permanent link">&para;</a></h3>
<p>Contains a value of type <code>State</code> to provide access to the current state. Any time the state of
workflow changes, <code>render</code> is called again to take into account the change in state.</p>
<h3 id="context"><code>context</code><a class="headerlink" href="#context" title="Permanent link">&para;</a></h3>
<p>The render context:</p>
<ul>
<li>provides a way for a workflow to defer to nested (child) workflows to generate some or all of its
  rendered output. We’ll walk through that process later on when we cover composition.</li>
<li>allows a workflow to request the execution of asynchronous tasks (<code>Worker</code>s)</li>
<li>generates event handlers for use in constructing view models.</li>
</ul>
<p>In order for us to see the anything in our app, we&rsquo;ll need to return a <code>Screen</code> that can be turned
into a view controller:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">RenderContext</span><span class="p">&lt;</span><span class="n">DemoWorkflow</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="n">DemoScreen</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">DemoScreen</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="s">&quot;A nice title&quot;</span><span class="p">)</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="actions-or-things-that-advance-a-workflow">Actions, or “Things that advance a workflow”<a class="headerlink" href="#actions-or-things-that-advance-a-workflow" title="Permanent link">&para;</a></h2>
<p>So far we have only covered workflows that perform simple tasks like generate strings or simple
screens with no actions. If our workflows take on a complicated roles like generating view models,
however, they will inevitably be required to handle events of some kind – some from UI events such
as button taps, others from infrastructure events such as network responses.</p>
<p>In conventional UIKit code, it is common to deal with each of those event types differently. The
common pattern is to implement a method like <code>handleButtonTap(sender:)</code>. Workflows are more strict
about events, however. Workflows require that all events be expressed as &ldquo;Workflow Actions.&rdquo;</p>
<p>These actions should be thought of as the entry point to your workflow. If any action of any kind
happens (that your workflow cares about), it should be modeled as an action.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">struct</span> <span class="nc">DemoWorkflow</span><span class="p">:</span> <span class="n">Workflow</span> <span class="p">{</span>
    <span class="c1">/// ...</span>
<span class="p">}</span>

<span class="kd">enum</span> <span class="nc">Action</span><span class="p">:</span> <span class="n">WorkflowAction</span> <span class="p">{</span>

    <span class="kd">typealias</span> <span class="n">WorkflowType</span> <span class="p">=</span> <span class="n">DemoWorkflow</span>

    <span class="k">case</span> <span class="n">refreshButtonTapped</span> <span class="c1">/// UI event</span>
    <span class="k">case</span> <span class="n">refreshRequestFinished</span><span class="p">(</span><span class="n">RefreshResponse</span><span class="p">)</span> <span class="c1">/// Network event</span>

    <span class="kd">func</span> <span class="nf">apply</span><span class="p">(</span><span class="n">toState</span> <span class="n">state</span><span class="p">:</span> <span class="kr">inout</span> <span class="n">DemoWorkflow</span><span class="p">.</span><span class="n">State</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">DemoWorkflow</span><span class="p">.</span><span class="n">Output</span><span class="p">?</span> <span class="p">{</span>
        <span class="c1">/// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="the-update-cycle">The Update Cycle<a class="headerlink" href="#the-update-cycle" title="Permanent link">&para;</a></h2>
<p>Every time a new action is received, it is applied to the current state of the workflow. If your
workflow does more than simply render values, the action&rsquo;s <code>apply</code> is the method where the logic lives.</p>
<p>There are two things that the <code>apply(toState:)</code> method is responsible for:</p>
<ul>
<li>Transitioning state</li>
<li>(Optionally) emitting an output event</li>
</ul>
<p>Note that the <code>render(state:context:)</code> method is called after every state change, so you can be sure
that any state changes will be reflected.</p>
<p>Since we have a way of expressing an event from our UI, we can now use the callback on our view
model to send that event back to the workflow:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">RenderContext</span><span class="p">&lt;</span><span class="n">DemoWorkflow</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="n">DemoScreen</span> <span class="p">{</span>
    <span class="c1">// Create a sink of our Action type so we can send actions back to the workflow.</span>
    <span class="kd">let</span> <span class="nv">sink</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">makeSink</span><span class="p">(</span><span class="n">of</span><span class="p">:</span> <span class="n">Action</span><span class="p">.</span><span class="kc">self</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">DemoScreen</span><span class="p">(</span>
        <span class="n">title</span><span class="p">:</span> <span class="s">&quot;A nice title&quot;</span><span class="p">,</span>
        <span class="n">onTap</span><span class="p">:</span> <span class="p">{</span> <span class="n">sink</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">Action</span><span class="p">.</span><span class="n">refreshButtonTapped</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h2 id="state_1">State<a class="headerlink" href="#state_1" title="Permanent link">&para;</a></h2>
<p>Some workflows do not need state at all – they simply render values based on the values they were
initialized with. But for more complicated workflows, state management is critical. For example, a
multi-screen flow only functions if we are able to define all of the possible steps (model the
state), remember which one we are currently on (persist state), and move to other steps in the
future (transition state).</p>
<p>To define your workflow&rsquo;s state, simply implement the associatedtype <code>State</code> via an enum or struct.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">struct</span> <span class="nc">WelcomeFlowWorkflow</span><span class="p">:</span> <span class="n">Workflow</span> <span class="p">{</span>

    <span class="kd">enum</span> <span class="nc">State</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">splashScreen</span>
        <span class="k">case</span> <span class="n">loginFlow</span>
        <span class="k">case</span> <span class="n">signupFlow</span>
    <span class="p">}</span>

    <span class="kd">enum</span> <span class="nc">Action</span><span class="p">:</span> <span class="n">WorkflowAction</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">back</span>
        <span class="c1">/// ...</span>
    <span class="p">}</span>

    <span class="c1">/// ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Workflows (and their <code>State</code>) should always be implemented through value types (structs and
enums) due to the way the framework handles state changes. This means that you can never capture
references to <code>self</code>, but the consistent flow of data pays dividends – try this architecture for
a while and we are confident that you will see the benefits.</p>
</div>
<h2 id="workers-or-asynchronous-work-the-workflow-needs-done">Workers, or &ldquo;Asynchronous work the workflow needs done&rdquo;<a class="headerlink" href="#workers-or-asynchronous-work-the-workflow-needs-done" title="Permanent link">&para;</a></h2>
<p>A workflow may need to do some amount of asynchronous work (such as a network request, reading from
a sqlite database, etc). Workers provide a declarative interface to units of asynchronous work.</p>
<p>To do something asynchronously, we define a worker that has an Output type and defines a <code>run</code>
method that that returns a Reactive Swift <code>SignalProducer</code>. When this worker will be run, the
<code>SignalProducer</code> is subscribed to starting the async task.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">struct</span> <span class="nc">RefreshWorker</span><span class="p">:</span> <span class="n">Worker</span> <span class="p">{</span>

    <span class="kd">enum</span> <span class="nc">Output</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">success</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">error</span><span class="p">(</span><span class="n">Error</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">run</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">SignalProducer</span><span class="p">&lt;</span><span class="n">RefreshWorker</span><span class="p">.</span><span class="n">Output</span><span class="p">,</span> <span class="n">NoError</span><span class="p">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">SignalProducer</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">&quot;We did it!&quot;</span><span class="p">))</span>
            <span class="p">.</span><span class="n">delay</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">on</span><span class="p">:</span> <span class="n">QueueScheduler</span><span class="p">.</span><span class="n">main</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">isEquivalent</span><span class="p">(</span><span class="n">to</span> <span class="n">otherWorker</span><span class="p">:</span> <span class="n">RefreshWorker</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Because a Worker is a declarative representation of work, it also needs to define an <code>isEquivalent</code>
to guarantee that we are not running more than one at the same time. For the simple example above,
it is always considered equivalent as we want only one of this type of worker running at a time.</p>
<p>In order to start asynchronous work, the workflow requests it in the render method, looking
something like:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">RenderContext</span><span class="p">&lt;</span><span class="n">DemoWorkflow</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="n">DemoScreen</span> <span class="p">{</span>

        <span class="n">context</span><span class="p">.</span><span class="n">awaitResult</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="n">RefreshWorker</span><span class="p">())</span> <span class="p">{</span> <span class="n">output</span> <span class="p">-&gt;</span> <span class="n">Action</span> <span class="k">in</span>
            <span class="k">switch</span> <span class="n">output</span> <span class="p">{</span>
            <span class="k">case</span> <span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="kd">let</span> <span class="nv">result</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">Action</span><span class="p">.</span><span class="n">refreshComplete</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">case</span> <span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="kd">let</span> <span class="nv">error</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">Action</span><span class="p">.</span><span class="n">refreshError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table>

<p>When the context is told to await a result from a worker, the context will do the following:</p>
<ul>
<li>Check if there is already a worker running of the same type:</li>
<li>If there is not, or <code>isEquivalent</code> is false, call <code>run</code> on the worker and subscribe to the
    <code>SignalProducer</code></li>
<li>If there is already a worker running and isEquivalent is true, continue to wait for it to
    produce an output.</li>
<li>When the SignalProducer from the Worker returns an output, it is mapped to an Action and handled
  the same way as any other action.</li>
</ul>
<h2 id="output-events">Output Events<a class="headerlink" href="#output-events" title="Permanent link">&para;</a></h2>
<p>The last role of the update cycle is to emit output events. As workflows form a hierarchy, it is
common for children to send events up the tree. This may happen when a child workflow finishes or
cancels, for example.</p>
<p>Workflows can define an output type, which may then be returned by Actions.</p>
<h2 id="composition">Composition<a class="headerlink" href="#composition" title="Permanent link">&para;</a></h2>
<p>Composition is the primary tool that we can use to manage complexity in a growing application.
Workflows should always be kept small enough to be understandable – less than 150 lines is a good
target. By composing together multiple workflows, complex problems can be broken down into
individual pieces that can be quickly understood by other developers (including future you).</p>
<p>The context provided to the <code>render(state:context:)</code> method defines the API through which
composition is made possible.</p>
<h3 id="the-render-context">The Render Context<a class="headerlink" href="#the-render-context" title="Permanent link">&para;</a></h3>
<p>The useful role of children is ultimately to provide rendered values (typically screen models) via
their <code>render(state:context:)</code> implementation. To obtain that value from a child workflow, the
<code>rendered(with context:key:)</code> method is invoked on the child workflow.</p>
<p>When a workflow is rendered with the context, the context will do the following:</p>
<ul>
<li>Check if the child workflow is new or existing:</li>
<li>If a workflow with the same type was used during the last render pass, the existing child
    workflow will be updated with the new workflow.</li>
<li>Otherwise, a new child workflow node will be initialized.</li>
<li>The child workflow&rsquo;s <code>render(state:context:)</code> method is called.</li>
<li>The rendered value is returned.</li>
</ul>
<p>In practice, this looks something like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">struct</span> <span class="nc">ParentWorkflow</span><span class="p">:</span> <span class="n">Workflow</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">RenderContext</span><span class="p">&lt;</span><span class="n">ParentWorkflow</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">childWorkflow</span> <span class="p">=</span> <span class="n">ChildWorkflow</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="s">&quot;Hello, World&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">childWorkflow</span><span class="p">.</span><span class="n">rendered</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">ChildWorkflow</span><span class="p">:</span> <span class="n">Workflow</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nv">text</span><span class="p">:</span> <span class="nb">String</span>

    <span class="c1">// ...</span>

    <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">RenderContext</span><span class="p">&lt;</span><span class="n">ChildWorkflow</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">String</span><span class="p">(</span><span class="n">text</span><span class="p">.</span><span class="n">reversed</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../tooling/" title="Tooling" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Tooling
              </span>
            </div>
          </a>
        
        
          <a href="../building-a-view-controller-from-screen/" title="Building a View Controller from a Screen" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Building a View Controller from a Screen
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Square, Inc.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://square.github.io/" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/square" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/squareeng" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/joinsquare/" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>